let JSQL=new JSQL_constructor('1FGhlktidC_5rmwbY7T1z8Jn76feaJtty5fz0IQVJTz4','AKfycbyYYihG8l7QthbD8Pcu6M9jYtyv57Q9KWM15iIQhFKEJL06ed7GKo5SCaXzS1_pGxeaDg',['main','members','sandbox']);function JSQL_constructor(sheet_url,script_url,tables) {__proto__:null,this.GOOGLE_SHEET_URL=sheet_url;this.GOOGLE_SCRIPT_URL=script_url,this.TABLES=tables;this.INSERT_VAR=0;this.request_parametrs={function:'function_name',table:'table_name'};this.get_sheet_url_by_table_name=function(table_name) {for(i=1;i<=this.TABLES.length;i++) {if(this.TABLES[i-1]==table_name) {return"https://spreadsheets.google.com/feeds/list/"+this.GOOGLE_SHEET_URL+"/"+i+"/public/values?alt=json";}} return"https://spreadsheets.google.com/feeds/list/"+this.GOOGLE_SHEET_URL+"/1/public/values?alt=json"};this.get_script_url=function() {return"https://script.google.com/macros/s/"+this.GOOGLE_SCRIPT_URL+"/exec";};};function check_condition(data,condition) {let hit=false;let COLUMN='';let CONDITION='';let VALUE='';for(let i=0;i<condition.length;i++) {hit=false;COLUMN=condition[i][0];CONDITION=condition[i][1];condition[i][2]=typeof(condition[i][2])=='string'?[condition[i][2]]:condition[i][2];for(let j=0;j<condition[i][2].length;j++) {VALUE=condition[i][2][j];if(CONDITION=='='){if(data[COLUMN]==VALUE) hit=true;}else if(CONDITION=='<>'||CONDITION=='!='){if(data[COLUMN]!=VALUE) hit=true;}else if(CONDITION=='>'){if(data[COLUMN]>=VALUE) hit=true;}else if(CONDITION=='>'){if(data[COLUMN]<=VALUE) hit=true;}else if(CONDITION=='LIKE'){if(data[COLUMN].toLowerCase().includes(VALUE.toLowerCase())) hit=true;}else if(CONDITION=='from'){if(new Date(data[COLUMN])>VALUE) hit=true;}else if(CONDITION=='to'){if(new Date(data[COLUMN])<VALUE) hit=true;}} if(hit==false) {return hit;}} return true;} function select_rows(data,rows) {let output=[];for(let i=0;i<rows.length;i++) {output.push(data[rows[i]]);} return output;} function condition_cols_to_lower(condition) {for(let i=0;i<condition.length;i++) {condition[i][0]=condition[i][0].toLowerCase();} return condition;} function row_cols_to_lower(rows) {for(let i=0;i<rows.length;i++) {rows[i]=rows[i].toLowerCase();} return rows;} function to_filter_out(data,rows=[],condition=[]) {let output=[];rows=row_cols_to_lower(rows);condition=condition_cols_to_lower(condition);for(let i=0;i<data.length;i++) {if(check_condition(data[i],condition)) {output.push(select_rows(data[i],rows))}} return output;} async function SELECT(table,rows=[],condition=[]) {return new Promise(function(resolve,reject) {let xmlhttp;xmlhttp=new XMLHttpRequest();xmlhttp.onreadystatechange=function() {if(xmlhttp.readyState==4&&xmlhttp.status==200) {data=get_object_from_JSON(JSON.parse(xmlhttp.responseText));resolve(to_filter_out(data,rows,condition));}};xmlhttp.onerror=function() {reject(new Error(`Ой-ой,что-то не так в запросе.Проверьте правильность url,подключение к Интернету или повторите запрос`));};xmlhttp.open("GET",JSQL.get_sheet_url_by_table_name(table),true);xmlhttp.send(null);});} function INSERT(table,rows=[]) {setTimeout(send_data,(JSQL.INSERT_VAR)*1000,table,'INSERT',rows);JSQL.INSERT_VAR++;} async function UPDATE(table,rows=[],condition=[]) {let ids=await SELECT(table,["id"],condition);rows.push(['id',JSON.stringify(ids.flat())]);send_data(table,'UPDATE',rows);} async function DELETE(table,condition=[]) {let ids=await SELECT(table,["id"],condition);send_data(table,'DELETE',[['id',JSON.stringify(ids.flat())]]);} async function COUNT(table,condition=[]) {let data=await SELECT(table,["id"],condition);return data.length;} function get_object_from_JSON(json_obj) {let keys=[] let result=[];let obj=new Object();let unfiltred_key='';json_obj=json_obj.feed.entry;for(let key in json_obj[0]) {unfiltred_key=key.split('$') if(unfiltred_key[1]!=undefined) {keys.push(key)}} for(let i=0;i<json_obj.length;i++) {obj=new Object();keys.forEach(function callbackFn(key) {obj[key.split('$')[1]]=json_obj[i][key].$t;});result[i]=obj;} return result;} function send_data(TABLE,FUNCTION,data) {let form=document.createElement('form');let id=Math.random();form.id='send_data_to_google';form.action=JSQL.get_script_url();form.method='POST';form.target='request_to_sheet_'+id;form.innerHTML=tag_input(FUNCTION,JSQL.request_parametrs.function)+ tag_input(TABLE,JSQL.request_parametrs.table)+ input_section(data)+"<input id='submit_and_send' type='submit'>";document.getElementsByTagName('body')[0].append(form);document.getElementsByTagName('body')[0].insertAdjacentHTML('beforeEnd',`<div id='${id}'style="display: none !important"name='${FUNCTION}_ELEMENT'><iframe name="request_to_sheet_${id}"src="#">Your browser does not support inline frames.</iframe></div>`);form.submit();setTimeout(delete_iframe,5000,id);document.getElementById('send_data_to_google').remove();} function delete_iframe(id) {document.getElementById(id).remove();} function tag_input(value,name) {return"<input type='text' name='"+name+"' value='"+value+"' >";} function input_section(data) {let output='';for(let i=0;i<data.length;i++) {output+=tag_input(data[i][1],data[i][0].toLowerCase());} output+=tag_input('authSuccess','jsonpCallback');return output;}